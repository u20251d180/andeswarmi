<div class="modal-overlay" *ngIf="product" (click)="onOverlayClick()">
  <aside
    class="product-modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="product-title"
    (click)="$event.stopPropagation()"
  >
    <!-- Botón de cierre -->
    <button class="close-btn" (click)="closeModal()" aria-label="Cerrar">✕</button>

    <!-- Contenido principal -->
    <div class="product-body">
      <!-- Imagen / Carrusel -->
      <div class="image-wrap">
        <ngb-carousel
          *ngIf="images && images.length > 1"
          [showNavigationArrows]="true"
          [showNavigationIndicators]="true"
        >
          <ng-template ngbSlide *ngFor="let img of images; let i = index">
            <img
              [src]="img"
              class="product-img"
              alt="{{ product.name }} - {{ i + 1 }}"
              (load)="onImageLoad(i)"
            />
            <div *ngIf="!imagesLoaded[i]" class="loading-text">Loading image...</div>
          </ng-template>
        </ngb-carousel>

        <!-- Imagen única -->
        <ng-container *ngIf="images?.length === 1">
          <img
            [src]="images[0]"
            class="product-img"
            alt="{{ product.name }}"
            (load)="onImageLoad(0)"
          />
          <div *ngIf="!imagesLoaded[0]" class="loading-text">Loading image...</div>
        </ng-container>

        <!-- Fallback: imagen principal -->
        <ng-container *ngIf="!images?.length && product?.image">
          <img
            [src]="product.image"
            class="product-img"
            alt="{{ product.name }}"
            (load)="onImageLoad(0)"
          />
          <div *ngIf="!imagesLoaded[0]" class="loading-text">Loading image...</div>
        </ng-container>

        <!-- Sin imagen -->
        <ng-container *ngIf="!images?.length && !product?.image">
          <div class="no-image">No image available</div>
        </ng-container>
      </div>

      <!-- Información del producto -->
      <div class="product-info">
        <p class="price">$ {{ product.price }}</p>
        <h2 id="product-title">{{ product.name }}</h2>
        <p class="desc">{{ product.description }}</p>
      </div>
    </div>

    <!-- Footer con botón -->
    <div class="product-footer">
      <button class="add-cart-btn" aria-label="Add to cart" (click)="addToCart(product)">
        <img src="assets/icons/bt_add_to_cart.svg" alt="cart" class="btn-icon" />
        Add to cart
      </button>
    </div>
  </aside>
</div>
